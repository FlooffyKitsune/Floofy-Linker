import{s as H,k as M,e as v,a as P,c as w,m as F,g as j,b as L,f as _,o as g,r as A,i as U,h as p,u as I,p as q,v as Z,w as G,t as y,d as C,j as D}from"../chunks/scheduler.v4c2umFH.js";import{S as J,i as K,c as Q,a as W,m as X,t as Y,b as $,d as x}from"../chunks/index.3VQIyI8a.js";import{A as ee}from"../chunks/AuthCheck.BSYET-OZ.js";import{u as te,h as B,j as se,w as le,i as R}from"../chunks/firebase.BUtuNcO3.js";function O(l){let e,n,s,i;return{c(){e=v("p"),n=y("Checking availability of @"),s=y(l[0]),i=y("..."),this.h()},l(t){e=w(t,"P",{class:!0});var r=L(e);n=C(r,"Checking availability of @"),s=C(r,l[0]),i=C(r,"..."),r.forEach(_),this.h()},h(){g(e,"class","text-secondary")},m(t,r){U(t,e,r),p(e,n),p(e,s),p(e,i)},p(t,r){r&1&&D(s,t[0])},d(t){t&&_(e)}}}function S(l){let e,n="must be 3-16 characters long, alphanumeric only";return{c(){e=v("p"),e.textContent=n,this.h()},l(s){e=w(s,"P",{class:!0,"data-svelte-h":!0}),F(e)!=="svelte-12is0jp"&&(e.textContent=n),this.h()},h(){g(e,"class","text-error text-sm")},m(s,i){U(s,e,i)},d(s){s&&_(e)}}}function V(l){let e,n,s,i;return{c(){e=v("p"),n=y("@"),s=y(l[0]),i=y(" is not available"),this.h()},l(t){e=w(t,"P",{class:!0});var r=L(e);n=C(r,"@"),s=C(r,l[0]),i=C(r," is not available"),r.forEach(_),this.h()},h(){g(e,"class","text-warning text-sm")},m(t,r){U(t,e,r),p(e,n),p(e,s),p(e,i)},p(t,r){r&1&&D(s,t[0])},d(t){t&&_(e)}}}function z(l){let e,n,s;return{c(){e=v("button"),n=y("Confirm username @"),s=y(l[0]),this.h()},l(i){e=w(i,"BUTTON",{class:!0});var t=L(e);n=C(t,"Confirm username @"),s=C(t,l[0]),t.forEach(_),this.h()},h(){g(e,"class","btn btn-success")},m(i,t){U(i,e,t),p(e,n),p(e,s)},p(i,t){t&1&&D(s,i[0])},d(i){i&&_(e)}}}function ie(l){let e,n="Username",s,i,t,r,a,d,b,T,E,N,f=l[1]&&O(l),u=!l[3]&&l[5]&&S(),c=l[3]&&!l[2]&&!l[1]&&V(l),m=l[2]&&z(l);return{c(){e=v("h2"),e.textContent=n,s=P(),i=v("form"),t=v("input"),r=P(),a=v("div"),f&&f.c(),d=P(),u&&u.c(),b=P(),c&&c.c(),T=P(),m&&m.c(),this.h()},l(o){e=w(o,"H2",{"data-svelte-h":!0}),F(e)!=="svelte-h7fq4i"&&(e.textContent=n),s=j(o),i=w(o,"FORM",{class:!0});var h=L(i);t=w(h,"INPUT",{type:!0,placeholder:!0,class:!0}),r=j(h),a=w(h,"DIV",{class:!0});var k=L(a);f&&f.l(k),d=j(k),u&&u.l(k),b=j(k),c&&c.l(k),T=j(k),m&&m.l(k),k.forEach(_),h.forEach(_),this.h()},h(){g(t,"type","text"),g(t,"placeholder","Username"),g(t,"class","input w-full"),A(t,"input-error",!l[3]&&l[5]),A(t,"input-warning",l[4]),A(t,"input-success",l[2]&&l[3]&&!l[1]),g(a,"class","my-4 min-h-16 px-8 w-full"),g(i,"class","w-2/5")},m(o,h){U(o,e,h),U(o,s,h),U(o,i,h),p(i,t),I(t,l[0]),p(i,r),p(i,a),f&&f.m(a,null),p(a,d),u&&u.m(a,null),p(a,b),c&&c.m(a,null),p(a,T),m&&m.m(a,null),E||(N=[q(t,"input",l[8]),q(t,"input",l[6]),q(i,"submit",Z(l[7]))],E=!0)},p(o,h){h&1&&t.value!==o[0]&&I(t,o[0]),h&40&&A(t,"input-error",!o[3]&&o[5]),h&16&&A(t,"input-warning",o[4]),h&14&&A(t,"input-success",o[2]&&o[3]&&!o[1]),o[1]?f?f.p(o,h):(f=O(o),f.c(),f.m(a,d)):f&&(f.d(1),f=null),!o[3]&&o[5]?u||(u=S(),u.c(),u.m(a,b)):u&&(u.d(1),u=null),o[3]&&!o[2]&&!o[1]?c?c.p(o,h):(c=V(o),c.c(),c.m(a,T)):c&&(c.d(1),c=null),o[2]?m?m.p(o,h):(m=z(o),m.c(),m.m(a,null)):m&&(m.d(1),m=null)},d(o){o&&(_(e),_(s),_(i)),f&&f.d(),u&&u.d(),c&&c.d(),m&&m.d(),E=!1,G(N)}}}function ne(l){let e,n;return e=new ee({props:{$$slots:{default:[ie]},$$scope:{ctx:l}}}),{c(){Q(e.$$.fragment)},l(s){W(e.$$.fragment,s)},m(s,i){X(e,s,i),n=!0},p(s,[i]){const t={};i&2111&&(t.$$scope={dirty:i,ctx:s}),e.$set(t)},i(s){n||(Y(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){x(e,s)}}}const ae=/^(?=[a-zA-Z0-9._]{3,16}$)(?!.*[_.]{2})[^_.].*[^_.]$/;function oe(l,e,n){let s,i,t,r;M(l,te,u=>n(10,r=u));let a="",d=!1,b=!1,T;async function E(){n(2,b=!1),clearTimeout(T),n(1,d=!0),T=setTimeout(async()=>{console.log("checking availability of",a);const u=B(R,"usernames",a),c=await se(u).then(m=>m.exists());n(2,b=!c),n(1,d=!1)},500)}async function N(){console.log("confirming username",a);const u=le(R);u.set(B(R,"usernames",a),{uid:r==null?void 0:r.uid}),u.set(B(R,"users",r.uid),{username:a,photoURL:(r==null?void 0:r.photoURL)??null,published:!0,bio:"No bio yet...",links:[{title:"Test Link",url:"https://kung.foo",icon:"custom"}]}),await u.commit()}function f(){a=this.value,n(0,a)}return l.$$.update=()=>{l.$$.dirty&1&&n(3,s=(a==null?void 0:a.length)>2&&a.length<16&&ae.test(a)),l.$$.dirty&1&&n(5,i=a.length>0),l.$$.dirty&14&&n(4,t=s&&!b&&!d)},[a,d,b,s,t,i,E,N,f]}class me extends J{constructor(e){super(),K(this,e,oe,ne,H,{})}}export{me as component};
